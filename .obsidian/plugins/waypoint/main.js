/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.create;var E=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var S=d=>E(d,"__esModule",{value:!0});var L=(d,t)=>{S(d);for(var e in t)E(d,e,{get:t[e],enumerable:!0})},v=(d,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of C(t))!x.call(d,i)&&i!=="default"&&E(d,i,{get:()=>t[i],enumerable:!(e=W(t,i))||e.enumerable});return d},D=d=>v(S(E(d!=null?I(A(d)):{},"default",d&&d.__esModule&&"default"in d?{get:()=>d.default,enumerable:!0}:{value:d,enumerable:!0})),d);var l=(d,t,e)=>new Promise((i,s)=>{var n=h=>{try{p(e.next(h))}catch(c){s(c)}},o=h=>{try{p(e.throw(h))}catch(c){s(c)}},p=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,o);p((e=e.apply(d,t)).next())});L(exports,{default:()=>b});var a=D(require("obsidian")),u;(function(i){i.InsideFolder="INSIDE_FOLDER",i.OutsideFolder="OUTSIDE_FOLDER",i.CustomFilename="CUSTOM_FILENAME"})(u||(u={}));var f;(function(e){e.Waypoint="waypoint",e.Landmark="landmark"})(f||(f={}));var P={waypointFlag:"%% Waypoint %%",landmarkFlag:"%% Landmark %%",stopScanAtFolderNotes:!1,showFolderNotes:!1,showNonMarkdownFiles:!1,foldersOnTop:!0,debugLogging:!1,useWikiLinks:!0,useFrontMatterTitle:!1,showEnclosingNote:!1,folderNoteType:u.InsideFolder,folderNoteFilename:"index",ignorePaths:["_attachments"],useSpaces:!1,numSpaces:2},w=class extends a.Plugin{constructor(){super(...arguments);this.foldersWithChanges=new Set;this.detectFlags=t=>l(this,null,function*(){this.detectFlag(t,f.Waypoint),this.detectFlag(t,f.Landmark)});this.detectFlag=(t,e)=>l(this,null,function*(){if(t&&this.ignorePath(t.path))return;this.log("Modification on "+t.name),this.log("Scanning for "+e+" flags...");let i=yield this.getWaypointFlag(e),n=(yield this.app.vault.cachedRead(t)).split(`
`);for(let o=0;o<n.length;o++)if(n[o].trim().includes(i))if(this.isFolderNote(t)){this.log("Found "+e+" flag in folder note!"),yield this.updateWaypoint(t,e),yield this.updateParentPoint(t.parent,this.settings.folderNoteType===u.OutsideFolder);return}else if(t.parent.isRoot()){this.log("Found "+e+" flag in root folder."),this.printError(t,"%% Error: Cannot create a "+e+" in the root folder of your vault. For more information, check the instructions [here](https://github.com/IdreesInc/Waypoint) %%",e);return}else{this.log("Found "+e+" flag in invalid note."),this.printError(t,"%% Error: Cannot create a "+e+" in a note that's not the folder note. For more information, check the instructions [here](https://github.com/IdreesInc/Waypoint) %%",e);return}this.log("No "+e+" flags found.")});this.updateChangedFolders=()=>l(this,null,function*(){this.log("Updating changed folders..."),this.foldersWithChanges.forEach(t=>{this.log("Updating "+t.path),this.updateParentPoint(t,!0)}),this.foldersWithChanges.clear()});this.scheduleUpdate=(0,a.debounce)(this.updateChangedFolders.bind(this),500,!0);this.updateParentPoint=(t,e)=>l(this,null,function*(){let[i,s]=yield this.locateParentPoint(t,e);s!==null&&(this.updateWaypoint(s,i),this.updateParentPoint(s.parent,!1))})}onload(){return l(this,null,function*(){yield this.loadSettings(),this.addCommand({id:"go_to_parent_waypoint",name:"Go to parent Waypoint",callback:()=>l(this,null,function*(){let e=this.app.workspace.getActiveFile().parent;this.settings.folderNoteType===u.InsideFolder&&(e=e==null?void 0:e.parent);let[,i]=yield this.locateParentPoint(e,u.InsideFolder===this.settings.folderNoteType);this.app.workspace.activeLeaf.openFile(i)})}),this.app.workspace.onLayoutReady(()=>l(this,null,function*(){this.registerEvent(this.app.vault.on("create",t=>{this.log("create "+t.name),this.foldersWithChanges.add(t.parent),this.scheduleUpdate()})),this.registerEvent(this.app.vault.on("delete",t=>{this.log("delete "+t.name);let e=this.getParentFolder(t.path);e!==null&&(this.foldersWithChanges.add(e),this.scheduleUpdate())})),this.registerEvent(this.app.vault.on("rename",(t,e)=>{this.log("rename "+t.name),this.foldersWithChanges.add(t.parent);let i=this.getParentFolder(e);i!==null&&this.foldersWithChanges.add(i),this.scheduleUpdate()})),this.registerEvent(this.app.vault.on("modify",this.detectFlags))})),this.addSettingTab(new T(this.app,this))})}onunload(){}isFolderNote(t){return this.settings.folderNoteType===u.InsideFolder?t.basename==t.parent.name:this.settings.folderNoteType===u.OutsideFolder?t.parent?this.app.vault.getAbstractFileByPath(this.getCleanParentPath(t)+t.basename)instanceof a.TFolder:!1:this.settings.folderNoteType===u.CustomFilename?t.basename==this.settings.folderNoteFilename:!1}getCleanParentPath(t){return t.parent instanceof a.TFolder&&t.parent.isRoot()?"":t.parent.path+"/"}printError(t,e,i){return l(this,null,function*(){this.log("Creating "+i+" error in "+t.path);let n=(yield this.app.vault.read(t)).split(`
`),o=-1,p=yield this.getWaypointFlag(i);for(let h=0;h<n.length;h++)n[h].trim().includes(p)&&(o=h);if(o===-1){console.error("Error: No "+i+" flag found while trying to print error.");return}n.splice(o,1,e),yield this.app.vault.modify(t,n.join(`
`))})}getWaypointBounds(t){return l(this,null,function*(){return t===f.Waypoint?[w.BEGIN_WAYPOINT,w.END_WAYPOINT]:t===f.Landmark?[w.BEGIN_LANDMARK,w.END_LANDMARK]:[null,null]})}getWaypointFlag(t){return l(this,null,function*(){return t===f.Waypoint?this.settings.waypointFlag:t===f.Landmark?this.settings.landmarkFlag:(console.error("Error: Invalid waypoint type: "+t),null)})}updateWaypoint(t,e){return l(this,null,function*(){this.log("Updating "+e+" in "+t.path);let i;if(this.settings.folderNoteType===u.InsideFolder||this.settings.folderNoteType===u.CustomFilename)i=yield this.getFileTreeRepresentation(t.parent,t.parent,0,!0);else{let F=this.app.vault.getAbstractFileByPath(this.getCleanParentPath(t)+t.basename);F instanceof a.TFolder&&(i=yield this.getFileTreeRepresentation(t.parent,F,0,!0))}let[s,n]=yield this.getWaypointBounds(e),o=`${s}
${i}

${n}`;if(s===null||n===null){console.error("Error: Waypoint bounds not found, unable to continue.");return}let p=yield this.getWaypointFlag(e),c=(yield this.app.vault.read(t)).split(`
`),m=-1,r=-1,g,y=!1;for(let F=0;F<c.length;F++){let N=c[F].trim();if(m===-1&&(N.includes(p)||N.includes(s))){g=N.startsWith(">"),y=N.includes(p),m=F;continue}if(m!==-1&&N.includes(n)){r=F;break}}if(m===-1){console.error("Error: No "+e+" found while trying to update "+t.path);return}this.log(e+" found at "+m+" to "+r),g&&(y&&(o=(e===f.Landmark?`[!landmark]
`:`[!waypoint]
`)+o),o=o.split(`
`).map(k=>`>${k}`).join(`
`)),c.splice(m,r!==-1?r-m+1:1,o),yield this.app.vault.modify(t,c.join(`
`))})}getFileTreeRepresentation(t,e,i,s=!1){return l(this,null,function*(){var c,m;let o=(this.settings.useSpaces?" ".repeat(this.settings.numSpaces):"	").repeat(i)+"-";if(!(e instanceof a.TFile)&&!(e instanceof a.TFolder)||(this.log(e.path),this.ignorePath(e.path)))return null;if(e instanceof a.TFile){this.settings.debugLogging&&console.log(e);let r;if(this.settings.useFrontMatterTitle){let g=(m=(c=this.app.metadataCache)==null?void 0:c.getFileCache(e))==null?void 0:m.frontmatter;g&&g.hasOwnProperty("title")&&(r=g.title)}else r=null;if(e.extension=="md"||e.extension=="base"){let g=e.extension==="base";if(this.settings.useWikiLinks){let y=g?e.basename+".base":e.basename;return g&&!r&&(r=e.basename),r?`${o} [[${y}|${r}]]`:`${o} [[${y}]]`}return r?`${o} [${r}](${this.getEncodedUri(t,e)})`:`${o} [${e.basename}](${this.getEncodedUri(t,e)})`}return this.settings.showNonMarkdownFiles?this.settings.useWikiLinks?`${o} [[${e.name}]]`:`${o} [${e.name}](${this.getEncodedUri(t,e)})`:null}let p="";if(!s||this.settings.showEnclosingNote){p=`${o} **${e.name}**`;let r;if(this.settings.folderNoteType===u.InsideFolder?r=this.app.vault.getAbstractFileByPath(e.path+"/"+e.name+".md"):e.parent&&(r=this.app.vault.getAbstractFileByPath(e.parent.path+"/"+e.name+".md")),r instanceof a.TFile&&(this.settings.useWikiLinks?p=`${o} **[[${r.basename}]]**`:p=`${o} **[${r.basename}](${this.getEncodedUri(t,r)})**`,!s)){if(this.settings.stopScanAtFolderNotes)return p;let g=yield this.app.vault.cachedRead(r);if(g.includes(w.BEGIN_WAYPOINT)||g.includes(this.settings.waypointFlag))return p}}if(!e.children||e.children.length==0)return`${o} **${e.name}**`;let h=e.children;if(h=h.sort((r,g)=>r.name.localeCompare(g.name,void 0,{numeric:!0,sensitivity:"base"})),!this.settings.showFolderNotes)if(this.settings.folderNoteType===u.InsideFolder)h=h.filter(r=>(this.settings.showFolderNotes||r.name!==e.name+".md")&&!this.ignorePath(r.path));else{let r=new Set;for(let g of h)g instanceof a.TFolder&&r.add(g.name+".md");h=h.filter(g=>(g instanceof a.TFolder||!r.has(g.name))&&!this.ignorePath(g.path))}if(h.length>0){let r=s&&!this.settings.showEnclosingNote?i:i+1;this.settings.foldersOnTop&&h.sort((g,y)=>g instanceof a.TFolder&&!(y instanceof a.TFolder)?-1:1),p+=(p===""?"":`
`)+(yield Promise.all(h.map(g=>this.getFileTreeRepresentation(t,g,r)))).filter(Boolean).join(`
`)}return p})}getEncodedUri(t,e){return t.isRoot()?`./${encodeURI(e.path)}`:`./${encodeURI(e.path.substring(t.path.length+1))}`}ignorePath(t){let e=!1;return this.settings.ignorePaths.forEach(i=>{if(i==="")return;let s=new RegExp(i);t.match(s)&&(this.log(`Ignoring path: ${t}`),e=!0)}),!!e}locateParentPoint(t,e){return l(this,null,function*(){this.log("Locating parent flag and file of "+t.name);let i=e?t:t.parent;for(;i;){let s;if(this.settings.folderNoteType===u.InsideFolder?s=this.app.vault.getAbstractFileByPath(i.path+"/"+i.name+".md"):this.settings.folderNoteType===u.CustomFilename?s=this.app.vault.getAbstractFileByPath(i.path+"/"+this.settings.folderNoteFilename+".md"):i.parent&&(s=this.app.vault.getAbstractFileByPath(this.getCleanParentPath(i)+i.name+".md")),s instanceof a.TFile){this.log("Found folder note: "+s.path);let n=yield this.app.vault.cachedRead(s);if(n.includes(w.BEGIN_WAYPOINT)||n.includes(this.settings.waypointFlag))return this.log("Found parent waypoint!"),[f.Waypoint,s];if(n.includes(w.BEGIN_LANDMARK)||n.includes(this.settings.landmarkFlag))return this.log("Found parent landmark!"),[f.Landmark,s]}i=i.parent}return this.log("No parent flag found."),[null,null]})}getParentFolder(t){let e=this.app.vault.getAbstractFileByPath(t.split("/").slice(0,-1).join("/"));return e instanceof a.TFolder?e:null}log(t){this.settings.debugLogging&&console.log(t)}loadSettings(){return l(this,null,function*(){this.settings=Object.assign({},P,yield this.loadData())})}saveSettings(){return l(this,null,function*(){yield this.saveData(this.settings)})}},b=w;b.BEGIN_WAYPOINT="%% Begin Waypoint %%",b.END_WAYPOINT="%% End Waypoint %%",b.BEGIN_LANDMARK="%% Begin Landmark %%",b.END_LANDMARK="%% End Landmark %%";var T=class extends a.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Waypoint Settings"}),new a.Setting(this.containerEl).setName("Folder Note Style").setDesc("Select the style of folder note used.").addDropdown(s=>s.addOption(u.InsideFolder,"Folder Name Inside").addOption(u.OutsideFolder,"Folder Name Outside").addOption(u.CustomFilename,"Custom Filename").setValue(this.plugin.settings.folderNoteType).onChange(n=>l(this,null,function*(){this.plugin.settings.folderNoteType=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Show Folder Notes").setDesc("If enabled, folder notes will be listed alongside other notes in the generated waypoints.").addToggle(s=>s.setValue(this.plugin.settings.showFolderNotes).onChange(n=>l(this,null,function*(){this.plugin.settings.showFolderNotes=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Show Non-Markdown Files").setDesc("If enabled, non-Markdown files will be listed alongside other notes in the generated waypoints.").addToggle(s=>s.setValue(this.plugin.settings.showNonMarkdownFiles).onChange(n=>l(this,null,function*(){this.plugin.settings.showNonMarkdownFiles=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Show Enclosing Note").setDesc("If enabled, the name of the folder note containing the waypoint will be listed at the top of the generated waypoints.").addToggle(s=>s.setValue(this.plugin.settings.showEnclosingNote).onChange(n=>l(this,null,function*(){this.plugin.settings.showEnclosingNote=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Folders on Top").setDesc("If enabled, folders will be listed at the top in the generated waypoints.").addToggle(s=>s.setValue(this.plugin.settings.foldersOnTop).onChange(n=>l(this,null,function*(){this.plugin.settings.foldersOnTop=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Stop Scan at Folder Notes").setDesc("If enabled, the waypoint generator will stop scanning nested folders when it encounters a folder note. Otherwise, it will only stop if the folder note contains a waypoint.").addToggle(s=>s.setValue(this.plugin.settings.stopScanAtFolderNotes).onChange(n=>l(this,null,function*(){this.plugin.settings.stopScanAtFolderNotes=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Use WikiLinks").setDesc("If enabled, links will be generated like [[My Page]] instead of [My Page](../Folder/My%Page.md).").addToggle(s=>s.setValue(this.plugin.settings.useWikiLinks).onChange(n=>l(this,null,function*(){this.plugin.settings.useWikiLinks=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Use Title Property").setDesc('If enabled, links will use the "title" frontmatter property for the displayed text (if it exists).').addToggle(s=>s.setValue(this.plugin.settings.useFrontMatterTitle).onChange(n=>l(this,null,function*(){this.plugin.settings.useFrontMatterTitle=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Use Spaces for Indentation").setDesc("If enabled, the waypoint list will be indented with spaces rather than with tabs.").addToggle(s=>s.setValue(this.plugin.settings.useSpaces).onChange(n=>l(this,null,function*(){this.plugin.settings.useSpaces=n,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Number of Spaces for Indentation").setDesc("If spaces are used for indentation, this is the number of spaces that will be used per indentation level.").addText(s=>s.setPlaceholder("2").setValue(""+this.plugin.settings.numSpaces).onChange(n=>l(this,null,function*(){let o=parseInt(n,10);isNaN(o)||(this.plugin.settings.numSpaces=o,yield this.plugin.saveSettings())}))),new a.Setting(t).setName("Waypoint Flag").setDesc("Text flag that triggers waypoint generation in a folder note. Must be surrounded by double-percent signs.").addText(s=>s.setPlaceholder(P.waypointFlag).setValue(this.plugin.settings.waypointFlag).onChange(n=>l(this,null,function*(){n&&n.startsWith("%%")&&n.endsWith("%%")&&n!=="%%"&&n!=="%%%"&&n!=="%%%%"?this.plugin.settings.waypointFlag=n:(this.plugin.settings.waypointFlag=P.waypointFlag,console.error("Error: Waypoint flag must be surrounded by double-percent signs.")),yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Landmark Flag").setDesc("Text flag that triggers landmark generation in a folder note. Must be surrounded by double-percent signs.").addText(s=>s.setPlaceholder(P.landmarkFlag).setValue(this.plugin.settings.landmarkFlag).onChange(n=>l(this,null,function*(){n&&n.startsWith("%%")&&n.endsWith("%%")&&n!=="%%"&&n!=="%%%"&&n!=="%%%%"?this.plugin.settings.landmarkFlag=n:(this.plugin.settings.landmarkFlag=P.landmarkFlag,console.error("Error: Landmark flag must be surrounded by double-percent signs.")),yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Ignored Files/Folders").setDesc("Regex list of files or folders to ignore while making indices. Enter only one regex per line.").addTextArea(s=>s.setPlaceholder(P.ignorePaths.join(`
`)).setValue(this.plugin.settings.ignorePaths.join(`
`)).onChange(n=>l(this,null,function*(){let o=n.trim().split(`
`).map(p=>this.getNormalizedPath(p));this.plugin.settings.ignorePaths=o,yield this.plugin.saveSettings()}))),new a.Setting(t).setName("Custom Folder Note Filename").setDesc("The filename of the folder note. Only used if the folder note style is set to Custom Filename.").addText(s=>s.setValue(this.plugin.settings.folderNoteFilename).onChange(n=>l(this,null,function*(){this.plugin.settings.folderNoteFilename=n,yield this.plugin.saveSettings()})));let e=t.createEl("div",{cls:"setting-item"}),i=e.createDiv({cls:"setting-item-description"});i.createSpan({text:"For instructions on how to use this plugin, check out the README on "}),i.createEl("a",{attr:{href:"https://github.com/IdreesInc/Waypoint"},text:"GitHub"}),i.createSpan({text:" or get in touch with the author "}),i.createEl("a",{attr:{href:"https://github.com/IdreesInc"},text:"@IdreesInc"}),e.appendChild(i)}getNormalizedPath(t){return t.length==0?t:(0,a.normalizePath)(t)}};

/* nosourcemap */